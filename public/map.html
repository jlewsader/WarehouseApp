<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Warehouse Map</title>
  <link rel="stylesheet" href="/css/styles.css" />
</head>
<body>

<header>
  <h1>Warehouse Map</h1>
</header>

<main>
  <div id="app" class="map-layout">
    <section class="inbound-panel" id="inbound">
      <div class="section-heading">
        <div>
          <p class="eyebrow">Inbound</p>
          <h2>Unassigned inventory</h2>
        </div>
        <label class="sort-control">
          Sort by
          <select v-model="inboundSort">
            <option value="brand">Brand</option>
            <option value="product_code">Product Code</option>
            <option value="lot">Lot Number</option>
            <option value="newest">Newest First</option>
          </select>
        </label>
      </div>

      <div v-if="!inbound.length" class="info-box">
        <p>No inbound inventory waiting to be placed.</p>
      </div>

      <div v-else class="inbound-list">
        <article
          v-for="group in inboundGroups"
          :key="group.key"
          class="inbound-group"
        >
          <header class="group-header">
            <div>
              <div class="group-title">{{ group.product.brand }} {{ group.product.product_code }}</div>
              <div class="group-meta">
                Lot: {{ group.product.lot || 'N/A' }}
                • Size: {{ group.product.seed_size || 'N/A' }}
                • Package: {{ group.product.package_type || 'N/A' }}
              </div>
            </div>
            <div class="group-qty">
              <div class="qty">{{ group.items.length }}</div>
              <small>packages</small>
            </div>
          </header>

          <div class="group-items">
            <label
              v-for="item in group.items"
              :key="item.id"
              class="inbound-row"
              :class="{ selected: selectedInboundId === item.id }"
            >
              <input
                type="radio"
                name="inboundSelection"
                :value="item.id"
                v-model="selectedInboundId"
              />
              <div class="row-body">
                <div class="row-main">
                  <strong>ID {{ item.id }}</strong>
                  <span class="pill">{{ item.units_per_package || 1 }} units</span>
                </div>
                <div class="row-sub">
                  Owner: {{ item.owner || 'N/A' }}
                </div>
              </div>
            </label>
          </div>
        </article>
      </div>
    </section>

    <section class="map-panel">

            <div class="map-actions">
        <div class="selection-summary">
          <p>
            <strong>Item to move: </strong>
            <span v-if="selectedMoveSummary">{{ selectedMoveSummary }}</span>
            <span v-else class="muted">Select inbound or click an occupied location.</span>
          </p>
          <p>
            <strong>Destination: </strong>
            <span v-if="selectedDestinationId">Location {{ selectedDestinationId }}</span>
            <span v-else class="muted">Choose an empty tier on the map.</span>
          </p>
        </div>
        <button
          :disabled="!selectedMoveInventoryId || !selectedDestinationId"
          @click="confirmMove"
        >
          Move item here
        </button>
      </div>

      <div class="section-heading">
        <div>
          <p class="eyebrow">Map</p>
          <h2>Warehouse layout</h2>
        </div>
        <div class="zone-switcher">
          <button
            v-for="zone in zones"
            :key="zone"
            @click="activeZone = zone"
            :class="{ active: activeZone === zone }"
          >
            {{ zone }}
          </button>
        </div>
      </div>

      <p class="section-subtitle">
        Active zone: <strong>{{ activeZone }}</strong> • Locations: {{ zoneLocations.length }}
      </p>

      <div class="warehouse" aria-label="Warehouse map">
        <div v-for="row in rows" :key="row.row" class="warehouse-row">
          <div class="row-label">Row {{ row.row }}</div>

          <div class="row-cells">
            <div
              v-for="cell in row.cells"
              :key="`${cell.row}-${cell.col}`"
              class="stack"
            >
              <!-- T -->
              <div
                class="tier"
                v-if="cell.tiers.T"
                :class="{
                  occupied: isOccupied(cell.tiers.T.id),
                  selected: selectedLocationId === cell.tiers.T.id
                }"
                @click="selectLocation(cell.tiers.T)"
              >
                <template v-if="inventoryAt(cell.tiers.T.id)">
                  <div class="product-code">
                    {{ inventoryAt(cell.tiers.T.id).product_code }}
                  </div>
                  <div class="lot">
                    Lot {{ inventoryAt(cell.tiers.T.id).lot }}
                  </div>
                </template>
                <template v-else>
                  <div class="empty">Empty</div>
                </template>
              </div>

              <!-- M -->
              <div
                class="tier"
                v-if="cell.tiers.M"
                :class="{
                  occupied: isOccupied(cell.tiers.M.id),
                  selected: selectedLocationId === cell.tiers.M.id
                }"
                @click="selectLocation(cell.tiers.M)"
              >
                <template v-if="inventoryAt(cell.tiers.M.id)">
                  <div class="product-code">
                    {{ inventoryAt(cell.tiers.M.id).product_code }}
                  </div>
                  <div class="lot">
                    Lot {{ inventoryAt(cell.tiers.M.id).lot }}
                  </div>
                </template>
                <template v-else>
                  <div class="empty">Empty</div>
                </template>
              </div>

              <!-- B -->
              <div
                class="tier"
                v-if="cell.tiers.B"
                :class="{
                  occupied: isOccupied(cell.tiers.B.id),
                  selected: selectedLocationId === cell.tiers.B.id
                }"
                @click="selectLocation(cell.tiers.B)"
              >
                <template v-if="inventoryAt(cell.tiers.B.id)">
                  <div class="product-code">
                    {{ inventoryAt(cell.tiers.B.id).product_code }}
                  </div>
                  <div class="lot">
                    Lot {{ inventoryAt(cell.tiers.B.id).lot }}
                  </div>
                </template>
                <template v-else>
                  <div class="empty">Empty</div>
                </template>
              </div>

            </div>
          </div>
        </div>
      </div>

    </section>

  </div>
</main>

<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>  
<script src="/js/map.js"></script>

</body>
</html>
